{ pkgs ? (import <nixpkgs> {})
, compiler ? pkgs.haskell.packages.ghc802
, ghc ? pkgs.haskell.compiler.ghc802
}:

with (import <nixpkgs/pkgs/development/haskell-modules/lib.nix> { inherit pkgs; });

let
  hackagePackages = import <nixpkgs/pkgs/development/haskell-modules/hackage-packages.nix>;
  stackPackages = { callPackage, pkgs, stdenv }:
self: {
      array = callPackage ({ base, mkDerivation, stdenv }:
      mkDerivation {
          pname = "array";
          version = "0.5.1.1";
          sha256 = "08r2rq4blvc737mrg3xhlwiw13jmsz5dlf2fd0ghb9cdaxc6kjc9";
          libraryHaskellDepends = [
            base
          ];
          doHaddock = false;
          doCheck = false;
          description = "Mutable and immutable arrays";
          license = stdenv.lib.licenses.bsd3;
        }) {};
      base = callPackage ({ ghc-prim, integer-gmp, mkDerivation, rts, stdenv }:
      mkDerivation {
          pname = "base";
          version = "4.9.1.0";
          sha256 = "0zpvf4yq52dkl9f30w6x4fv1lqcc175i57prhv56ky06by08anvs";
          libraryHaskellDepends = [
            ghc-prim
            integer-gmp
            rts
          ];
          doHaddock = false;
          doCheck = false;
          description = "Basic libraries";
          license = stdenv.lib.licenses.bsd3;
        }) {};
      bytestring = callPackage ({ HUnit, QuickCheck, base, byteorder, deepseq, directory, dlist, ghc-prim, integer-gmp, mkDerivation, mtl, random, stdenv, test-framework, test-framework-hunit, test-framework-quickcheck2 }:
      mkDerivation {
          pname = "bytestring";
          version = "0.10.8.1";
          sha256 = "16zwb1p83z7vc5wlhvknpy80b5a2jxc5awx67rk52qnp9idmyq9d";
          libraryHaskellDepends = [
            base
            deepseq
            ghc-prim
            integer-gmp
          ];
          testHaskellDepends = [
            base
            byteorder
            deepseq
            directory
            dlist
            ghc-prim
            HUnit
            mtl
            QuickCheck
            random
            test-framework
            test-framework-hunit
            test-framework-quickcheck2
          ];
          doHaddock = false;
          doCheck = false;
          homepage = "https://github.com/haskell/bytestring";
          description = "Fast, compact, strict and lazy byte strings with a list interface";
          license = stdenv.lib.licenses.bsd3;
        }) {};
      deepseq = callPackage ({ HUnit, array, base, mkDerivation, stdenv, test-framework, test-framework-hunit }:
      mkDerivation {
          pname = "deepseq";
          version = "1.4.2.0";
          sha256 = "0la9x4hvf1rbmxv8h9dk1qln21il3wydz6wbdviryh4h2wls22ny";
          libraryHaskellDepends = [
            array
            base
          ];
          testHaskellDepends = [
            array
            base
            HUnit
            test-framework
            test-framework-hunit
          ];
          doHaddock = false;
          doCheck = false;
          description = "Deep evaluation of data structures";
          license = stdenv.lib.licenses.bsd3;
        }) {};
      dep1 = callPackage ({ base, fetchgit, mkDerivation, stdenv }:
      mkDerivation {
          pname = "dep1";
          version = "0.1.0.0";
          src = fetchgit {
            url = "https://github.com/jmitchell/haskell-multi-package-demo1.git";
            sha256 = "0mxpn41qizy965n9ghjazisvx2ci0mmlq37iyqpji395qf0860s3";
            rev = "e3d9bd6d6066dab5222ce53fb7d234f28eafa2d5";
          };
          postUnpack = "sourceRoot+=/dep1; echo source root reset to \$sourceRoot";
          libraryHaskellDepends = [
            base
          ];
          doHaddock = false;
          doCheck = false;
          license = stdenv.lib.licenses.bsd3;
        }) {};
      dep2 = callPackage ({ base, fetchgit, mkDerivation, stdenv }:
      mkDerivation {
          pname = "dep2";
          version = "0.1.0.0";
          src = fetchgit {
            url = "https://github.com/jmitchell/haskell-multi-package-demo1.git";
            sha256 = "0mxpn41qizy965n9ghjazisvx2ci0mmlq37iyqpji395qf0860s3";
            rev = "e3d9bd6d6066dab5222ce53fb7d234f28eafa2d5";
          };
          postUnpack = "sourceRoot+=/dep2; echo source root reset to \$sourceRoot";
          libraryHaskellDepends = [
            base
          ];
          doHaddock = false;
          doCheck = false;
          license = stdenv.lib.licenses.bsd3;
        }) {};
      ghc-prim = callPackage ({ mkDerivation, rts, stdenv }:
      mkDerivation {
          pname = "ghc-prim";
          version = "0.5.0.0";
          sha256 = "1cnn5gcwnc711ngx5hac3x2s4f6dkdl7li5pc3c02lcghpqf9fs4";
          libraryHaskellDepends = [ rts ];
          doHaddock = false;
          doCheck = false;
          description = "GHC primitives";
          license = stdenv.lib.licenses.bsd3;
        }) {};
      haskell-dummy-package1 = callPackage ({ base, fetchgit, mkDerivation, stdenv }:
      mkDerivation {
          pname = "haskell-dummy-package1";
          version = "0.1.0.0";
          src = fetchgit {
            url = "https://github.com/jmitchell/haskell-dummy-project1";
            sha256 = "14b4mgbi8a7mig8mfypn95c52wlvlhzafqslmlb3y3xlpg3fjgr0";
            rev = "7e7d91d86ba0f86633ab37279c013879ade09e32";
          };
          libraryHaskellDepends = [
            base
          ];
          doHaddock = false;
          doCheck = false;
          license = stdenv.lib.licenses.bsd3;
        }) {};
      haskell-multi-proj-demo1 = callPackage ({ base, bytestring, dep1, dep2, fetchgit, haskell-dummy-package1, mkDerivation, stdenv }:
      mkDerivation {
          pname = "haskell-multi-proj-demo1";
          version = "0.1.0.0";
          src = fetchgit {
            url = "https://github.com/jmitchell/haskell-multi-package-demo1.git";
            sha256 = "0mxpn41qizy965n9ghjazisvx2ci0mmlq37iyqpji395qf0860s3";
            rev = "e3d9bd6d6066dab5222ce53fb7d234f28eafa2d5";
          };
          isLibrary = false;
          isExecutable = true;
          executableHaskellDepends = [
            base
            bytestring
            dep1
            dep2
            haskell-dummy-package1
          ];
          doHaddock = false;
          doCheck = false;
          license = stdenv.lib.licenses.bsd3;
        }) {};
      integer-gmp = callPackage ({ ghc-prim, mkDerivation, stdenv }:
      mkDerivation {
          pname = "integer-gmp";
          version = "1.0.0.1";
          sha256 = "08f1qcp57aj5mjy26dl3bi3lcg0p8ylm0qw4c6zbc1vhgnmxl4gg";
          revision = "1";
          editedCabalFile = "616d1775344a82a0ae1db1791fba719f4682a1ace908582ac4026db14231d4d5";
          libraryHaskellDepends = [
            ghc-prim
          ];
          doHaddock = false;
          doCheck = false;
          description = "Integer library based on GMP";
          license = stdenv.lib.licenses.bsd3;
        }) {};
    };
in
compiler.override {
  initialPackages = (args: self: (hackagePackages args self) // (stackPackages args self));
}
